function ViciWidget(a,b){function f(){return!!("ontouchstart"in window)}function g(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="; expires="+d.toGMTString()}else var e="";document.cookie=a+"="+escape(b)+e+"; path=/"}function h(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return unescape(e.substring(b.length,e.length))}return null}function i(a){g(a,"",-1)}function n(){var a=s.getBounds(),b=s.getZoom();for(var c in A)a.contains(A[c].getPosition())&&!(A[c].zoom_small>b)||A[c].state_high||(google.maps.event.clearInstanceListeners(A[c]),A[c].setMap(null),delete A[c])}function p(a,d){function e(a){highlightsArr=a.features,y(B.markerId)}$.ajax({url:c+"/highlight.php?perspective="+b.perspective+"&bounds="+a+"&zoom="+d+"&n="+r.highlights+"&era="+r.era+"&visibility="+r.visibility+m,dataType:"json",success:e})}function x(){w.innerHTML="safari"}function y(a){var b="";if(-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&highlightsArr.length<1&&x(),A[a]){var d=A[a];b+='<div style="float:right; width: 18px; height: 18px; margin-right:2px; margin-top:2px;"><img id="vici_sel_close" src="'+c+'/images/close-button.png"/></div>',b+="<div style='font-size: 1.2em;font-weight:bold; margin-left:8px; margin-top:4px;'>"+l.selection+":</div>",b+='<div style="padding:5px; margin-bottom:0px"><a href="'+d.url+'"><img  src="data:image/gif;base64,R0lGODlhAQABAIAAAP//////zCH5BAEHAAAALAAAAAABAAEAAAICRAEAOw==" class="marker infomarker icon'+d.kind+'" width="32" height="37"></a><div style="font-weight:bold">'+d.title+"</div>",d.picture?(b+='<div style="margin:2px 0px 0px 37px; position: relative"><a href="'+d.url+'"><img src="'+window.location.protocol+"//static.vici.org/cache/220x124-2"+d.picture+'" style="border:0"></a>',b+='<div style="position: absolute; bottom:3px; left:0px; width:220px; background-image: url('+c+'/images/black_50.png);">'+d.html+' [&nbsp;<a href="'+d.url+'">'+l.more+"</a>&nbsp;]</div>",b+="</div>"):b+='<div style="margin-left:37px">'+d.html+' [&nbsp;<a href="'+d.url+'">'+l.more+"</a>&nbsp;]</div>",b+="</div>"}else var a=0;var e="";if(highlightsArr.length>0)for(var f in highlightsArr){var g=highlightsArr[f];g.properties.id!=a&&(e+='<div style="padding:5px; margin-bottom:0px"><img id="vici_high_icon'+f+'" src="'+c+"/images/"+g.properties.kind+'.png" style="float: left; vertical-align:text-top; margin-top: -4px; margin-right: 4px; cursor: pointer; border:0" "/><div style="font-weight:bold">'+g.properties.title+"</div>",g.properties.img?(e+='<div style="margin:2px 0px 0px 37px;position:relative;cursor: pointer"><img id="vici_high_image'+f+'" src="'+window.location.protocol+"//static.vici.org/cache/220x124-2"+g.properties.img+'">',e+='<div style="position: absolute; bottom:3px; left:0px; width:220px; background-image: url('+c+'/images/black_50.png);">'+g.properties.summary+' [&nbsp;<a class="vici_box" href="#" id="vici_high_link'+f+'">'+l.show+"</a>&nbsp;]</div>",e+="</div>"):e+='<div style="margin-left:37px">'+g.properties.summary+' [&nbsp;<a class="vici_box" href="#" id="vici_high_link'+f+'">'+l.show+"</a>&nbsp;]</div>",e+="</div>")}if(e&&(b&&(b+='<div style="width:100%; height:1px; background-color:#777;margin-top:2px"></div>'),b+='<div style="float:right; width: 18px; height: 18px; margin-right:2px; margin-top:2px;"><img id="vici_high_close" src="'+c+'/images/close-button.png"/></div>',b+="<div style='font-size: 1.2em;font-weight:bold; margin-left:8px; margin-top:4px;'>"+l.Featured+":</div>"+e),w.innerHTML=b,A[a]&&$("#vici_sel_close").click(C),e&&$("#vici_high_close").click(D),highlightsArr.length>0)for(var f in highlightsArr)highlightsArr[f].properties.id!=a&&($("#vici_high_link"+f).click(function(){var a=this.id.replace("vici_high_link","");E(A[highlightsArr[a].properties.id],!0)}),$("#vici_high_icon"+f).click(function(){var a=this.id.replace("vici_high_icon","");E(A[highlightsArr[a].properties.id],!0)}),highlightsArr[f].properties.img&&$("#vici_high_image"+f).click(function(){var a=this.id.replace("vici_high_image","");E(A[highlightsArr[a].properties.id],!0)}))}function E(a,c){g("focus",a.id,30),B.markerId&&(B.markerId==a.id?window.location.href=a.url:A[B.markerId].restoreState(s.getZoom())),B.markerId=a.id,B.marker.position=a.position,B.marker.setVisible(!0),B.marker.setIcon(B.marker.icon),a.raiseState(),b.focus?b.focus!=a.id&&(window.location.href=a.url):y(B.markerId),c&&(s.panTo(a.position),s.getZoom()<a.zoom_normal&&s.setZoom(a.zoom_normal))}var c=".dev"==window.location.hostname.match(/\.dev$/)?window.location.protocol+"//vici.dev":window.location.protocol+"//vici.org";"absolute"!=$(a).css("position")&&(a.style.position="relative");for(var d=[],e=1;26>e;e++)d[e]={small:new google.maps.MarkerImage(c+"/images/markers_minimal.png",new google.maps.Size(12,12),new google.maps.Point(12*e-12,0),new google.maps.Point(6,6)),normal:new google.maps.MarkerImage(c+"/images/markers_opac.png",new google.maps.Size(32,37),new google.maps.Point(32*e-32,0),new google.maps.Point(16,37)),opac:new google.maps.MarkerImage(c+"/images/markers_opac.png",new google.maps.Size(32,37),new google.maps.Point(32*e-32,37),new google.maps.Point(16,37))};var j=b.lang?b.lang:(navigator.language||navigator.userLanguage).substring(0,2);$.inArray(j,["de","en","fr","nl"])<0&&(j="en");var k={de:{selection:"Selektion",more:"weiter",show:"anzeigen",Featured:"Schaukasten",Adjust_view:"Ansicht &auml;ndern",touristic_vs_archeological:"Touristische oder arch&auml;ologische St&auml;tten",museums_etc:"Museen und andere zeitgen&ouml;ssische St&auml;tten",museums_and_archeological:"Sowohl zeitgen&ouml;ssische als r&ouml;mischen St&auml;tten",roman_only:"Nur arch&auml;ologische St&auml;tten",visibility_of_sites:"Nur sichtbare oder alle Objekte zeigen",visible_sites:"Nur sichtbare Objekte",visible_and_invisible:"Alle Objekte zeigen",Map_background:"Hintergrund",satellite:"Satellitbild",satellite_labels:"Satellitebild mit Labels",pelagios:"Digital Atlas of the Roman Empire (DARE)"},en:{selection:"Selection",more:"more",show:"show",Featured:"Featured",Adjust_view:"Adjust view settings",touristic_vs_archeological:"Show tourist or archeological sites",museums_etc:"Museums and other contemporary sites",museums_and_archeological:"Both contemporary and Roman sites",roman_only:"Ancient Roman only",visibility_of_sites:"Visibility of sites to display",visible_sites:"Visible sites",visible_and_invisible:"Both visible and invisible sites",Map_background:"Map background",satellite:"Satellite",satellite_labels:"Satellite with labels",pelagios:"Digital Atlas of the Roman Empire (DARE)"},fr:{selection:"Selection",more:"plus",show:"exposer",Featured:"Pr&eacute;sent&eacute;",Adjust_view:"Adjust view settings",touristic_vs_archeological:"Show tourist or archeological sites",museums_etc:"Museums and other contemporary sites",museums_and_archeological:"Both contemporary and Roman sites",roman_only:"Ancient Roman only",visibility_of_sites:"Visibility of sites to display",visible_sites:"Visible sites",visible_and_invisible:"Both visible and invisible sites",Map_background:"Map background",satellite:"Satellite",satellite_labels:"Satellite with labels",pelagios:"Digital Atlas of the Roman Empire (DARE)"},nl:{selection:"Geselecteerd",more:"meer",show:"toon",Featured:"Uitgelicht",Adjust_view:"Wat te tonen",touristic_vs_archeological:"Toeristisch of archeologisch",museums_etc:"Musea en andere hedendaagse plekken",museums_and_archeological:"Hedendaagse &eacute;n archeologische plekken",roman_only:"Enkel Romeinse archeologische locaties",visibility_of_sites:"Zichtbaarheid",visible_sites:"Enkel zichtbare plaatsen of objecten",visible_and_invisible:"Zichtbare en niet-zichtbare objecten",Map_background:"Achtergrondkaart",satellite:"Satelliet",satellite_labels:"Satelliet met hedendaagse aanduidingen",pelagios:"Digital Atlas of the Roman Empire (DARE)"}},l=k[j],m=j==(navigator.language||navigator.userLanguage).substring(0,2)?"":"&lang="+j;b.perspective=function(){return b.perspective&&$.inArray(b.perspective,["pleiades","romaq","livius"])>-1?b.perspective:""}(),b.model=function(){return b.model&&"flat"==b.model?"&flat":""}();var o=function(a){function e(a){n(),g(a),f(a)}function f(b){var c=function(a){var b=1+a-this.growZoom;return 0>b&&(b=0),this.nominalWeight*Math.pow(2,b)};for(var d in b.lines){var e=b.lines[d];if(!z[e.id]||z[e.id]&&z[e.id].expire<=o){var f=[];for(var g in e.points)f.push(new google.maps.LatLng(e.points[g][0],e.points[g][1]));var h={path:f,markerId:e.marker,strokeColor:"#FF0000",strokeOpacity:1,nominalWeight:3,expire:e.expire,growZoom:16,calcWeight:c};switch(e.kind){case"aqueduct":h.strokeColor="#00ECF7",h.nominalWeight=2;break;case"canal":h.strokeColor="#1111FF",h.nominalWeight=3,h.growZoom=16;break;case"road":h.growZoom=17;break;case"wall":h.growZoom=17,h.strokeColor="#C4A548";break;case"other":h.nominalWeight=2,h.growZoom=19,h.strokeColor="#fdff0c"}if(h.strokeWeight=h.calcWeight(o),z[e.id])z[e.id].setOptions(h);else{var i=new google.maps.Polyline(h);i.setMap(a),google.maps.event.addListener(i,"click",function(){E(A[this.markerId],!0)}),z[e.id]=i}}}}function g(e){var f=function(a){this.state_high=!1,this.zIndex=this.zIndex-20,this.selectImage()},g=function(){this.state_high=!0,this.zIndex=this.zIndex+20,this.icon=this.image_normal,this.setIcon(this.icon)},i=function(){var b=a.getZoom(),c=this.state_high,d=this.zoom_small<=b,e="anyVisibility"==r.visibility||this.objectvisible,f="RomanAndContemporary"==r.era||"onlyContemporary"==r.era&&this.contemporary||"onlyRoman"==r.era&&!this.contemporary;this.visible=c||d&&e&&f,b>=this.zoom_normal||this.state_high?this.icon=this.image_normal:this.icon=this.image_small,this.setIcon(this.icon)};for(var j in e.features){var k=e.features[j];if(!A[k.properties.id]){var l=new google.maps.Marker({id:k.properties.id,contemporary:8==k.properties.kind||19==k.properties.kind,url:function(){return b.perspective?k.properties.url:c+k.properties.url}(),position:new google.maps.LatLng(k.geometry.coordinates[1],k.geometry.coordinates[0]),map:a,title:k.properties.title,html:k.properties.summary,objectvisible:"1"==k.properties.isvisible,zoom_small:parseInt(k.properties.zoomsmall),zoom_normal:parseInt(k.properties.zoomnormal),image_small:d[k.properties.kind].small,image_normal:k.properties.identified?d[k.properties.kind].normal:d[k.properties.kind].opac,state_high:!1,icon:this.image_normal,kind:k.properties.kind,picture:k.properties.img,zIndex:k.properties.zindex,selectImage:i,restoreState:f,raiseState:g});l.selectImage(),google.maps.event.addListener(l,"click",function(){E(this,!1)}),A[l.id]=l}}var m=parseInt(h("focus"));b.focus&&(m=b.focus),m&&A[m]&&null==B.markerId&&E(A[m],!1)}var i=a.getBounds().getSouthWest().lat(),j=a.getBounds().getSouthWest().lng(),k=a.getBounds().getNorthEast().lat(),l=a.getBounds().getNorthEast().lng(),o=a.getZoom();$.ajax({url:c+"/data.php?numeric"+b.model+"&perspective="+b.perspective+"&bounds="+i+","+j+","+k+","+l+"&zoom="+o+m,dataType:"json",success:e})},q={center:function(){var a,c;return a=b.center?b.center.lat:41.895,c=b.center?b.center.lng:12.485,new google.maps.LatLng(a,c)}(),zoom:function(){return b.zoom?b.zoom:10}(),minZoom:function(){return b.minZoom?b.minZoom:5}(),streetViewControl:!1,panControl:!1,zoomControl:!f(),mapTypeControl:!1,mapTypeId:function(){switch(b.mapTypeId){case"IMPERIUM":return"IMPERIUM";case"HYBRID":return google.maps.MapTypeId.HYBRID;default:return google.maps.MapTypeId.SATELLITE}}()},r={highlights:b.highlights?parseInt(b.highlights):0,visibility:b.preferences&&b.preferences.visibility?b.preferences.visibility:"anyVisibility",era:b.preferences&&b.preferences.era?b.preferences.era:"RomanAndContemporary",map:b.mapTypeId?b.mapTypeId:"HYBRID"};if(b.showPrefbox&&(r.era=h("era")?h("era"):r.era,r.visibility=h("visibility")?h("visibility"):r.visibility,h("map")))switch((r.map=h("map"))||(r.map="SATELLITE"),r.map){case"SATELLITE":q.mapTypeId=google.maps.MapTypeId.SATELLITE;break;case"HYBRID":q.mapTypeId=google.maps.MapTypeId.HYBRID;break;case"IMPERIUM":q.mapTypeId="IMPERIUM"}!b.zoom&&h("zoom")&&(q.zoom=parseInt(h("zoom")),h("minzoom")&&(q.zoom=parseInt(h("minzoom"))>q.zoom?parseInt(h("minzoom")):q.zoom)),!b.center&&h("center")?q.center=function(){var a=h("center");return storedLatlngArr=a.replace("(","").replace(")","").split(",",2),new google.maps.LatLng(parseFloat(storedLatlngArr[0]),parseFloat(storedLatlngArr[1]))}():navigator.geolocation&&!b.center&&navigator.geolocation.getCurrentPosition(function(a){s.setCenter(new google.maps.LatLng(a.coords.latitude,a.coords.longitude))});var s=new google.maps.Map(a,q),t=new google.maps.ImageMapType({getTileUrl:function(a,b){return"//static.vici.org/tiles/imperium/"+b+"/"+a.x+"/"+a.y+".png"},tileSize:new google.maps.Size(256,256),isPng:!0,minZoom:5,maxZoom:11,name:"IMPERIUM",alt:"Imperium Romanum"});s.mapTypes.set("IMPERIUM",t),$(a).append($('<div id="imperiumBox" style="position:absolute;bottom:18px;right:0;color:#222;font-family:Helvetica;font-size:9px;padding:3px;background-color:#eee;z-index:2">Background © <a href="http://dare.ht.lu.se/" style="color:#222">'+l.pelagios+"</a>")),"IMPERIUM"!=q.mapTypeId&&$("#imperiumBox").hide(),b.showPrefbox?vicistyle="#"+a.id+" div a[target='_blank'] img[src*='google'] {top:-25px !important;} ":vicistyle="",vicistyle+="#"+a.id+" img {border:0} ",vicistyle+="#"+a.id+" a:link {text-decoration:underline;color:#fff} ",vicistyle+="#"+a.id+" a:visited {text-decoration:underline;color:#fff} ",vicistyle+="#"+a.id+" a:hover{text-decoration:underline;color:#fff} ",vicistyle+="#"+a.id+" a:active{text-decoration:underline;color:#fff} ",vicistyle+=".infomarker{float:left;vertical-align:text-top;margin-top:-2px;margin-right:5px;cursor:pointer} ",vicistyle+=".marker{width:32px;height:37px;display:inline-block} ",vicistyle+=".icon1{background:url("+c+"/images/markers.png) 0 0} ",vicistyle+=".icon2{background:url("+c+"/images/markers.png) -32px 0} ",vicistyle+=".icon3{background:url("+c+"/images/markers.png) -64px 0} ",vicistyle+=".icon4{background:url("+c+"/images/markers.png) -96px 0} ",vicistyle+=".icon5{background:url("+c+"/images/markers.png) -128px 0} ",vicistyle+=".icon6{background:url("+c+"/images/markers.png) -160px 0} ",vicistyle+=".icon7{background:url("+c+"/images/markers.png) -192px 0} ",vicistyle+=".icon8{background:url("+c+"/images/markers.png) -224px 0} ",vicistyle+=".icon9{background:url("+c+"/images/markers.png) -256px 0} ",vicistyle+=".icon10{background:url("+c+"/images/markers.png) -288px 0} ",vicistyle+=".icon11{background:url("+c+"/images/markers.png) -320px 0} ",vicistyle+=".icon12{background:url("+c+"/images/markers.png) -352px 0} ",vicistyle+=".icon13{background:url("+c+"/images/markers.png) -384px 0} ",vicistyle+=".icon14{background:url("+c+"/images/markers.png) -416px 0} ",vicistyle+=".icon15{background:url("+c+"/images/markers.png) -448px 0} ",vicistyle+=".icon16{background:url("+c+"/images/markers.png) -480px 0} ",vicistyle+=".icon17{background:url("+c+"/images/markers.png) -512px 0} ",vicistyle+=".icon18{background:url("+c+"/images/markers.png) -544px 0} ",vicistyle+=".icon19{background:url("+c+"/images/markers.png) -576px 0} ",vicistyle+=".icon20{background:url("+c+"/images/markers.png) -608px 0} ",vicistyle+=".icon21{background:url("+c+"/images/markers.png) -640px 0} ",vicistyle+=".icon22{background:url("+c+"/images/markers.png) -672px 0} ",vicistyle+=".icon23{background:url("+c+"/images/markers.png) -704px 0} ",vicistyle+=".icon24{background:url("+c+"/images/markers.png) -736px 0} ",vicistyle+=".icon25{background:url("+c+"/images/markers.png) -768px 0} ",vicistyle+=".blur{opacity:50} ";var u=document.createElement("style");if(u.type="text/css",u.styleSheet?u.styleSheet.cssText=vicistyle:u.appendChild(document.createTextNode(vicistyle)),document.getElementsByTagName("head")[0].appendChild(u),b.showPrefbox){var v=document.createElement("div");v.style.position="absolute",v.style.bottom="0px",v.style.left="6px",v.style.color="#fff",v.style.fontFamily="Helvetica",v.style.fontSize="12px",v.style.lineHeight="120%",v.style.backgroundImage="url("+c+"/images/black_50.png)",v.style.borderTopLeftRadius="12px",v.style.borderTopRightRadius="12px",v.style.zIndex="2",v.innerHTML='<div style="position:relative"><div id="vicihandle" style="width:100%; font-size: 1.2em;font-weight:bold; margin:4px 8px; cursor: pointer;padding-right:14px"><img style="vertical-align:bottom;width:18px;height:18px;background:url('+c+'/images/icons-18-white.png) -792px 0;" src="'+c+'/images/trans.gif" width="1" height="1" />'+l.Adjust_view+'</div><div id="viciform" style="display:none; margin:4px 8px;"><div style="margin-top:8px"><strong>'+l.touristic_vs_archeological+':</strong></div><input type="radio" name="era" value="onlyContemporary" id="onlyContemporary"><label for="onlyContemporary"> '+l.museums_etc+'</label><br/><input type="radio" name="era" value="RomanAndContemporary" id="RomanAndContemporary"><label for="RomanAndContemporary"> '+l.museums_and_archeological+'</label><br/><input type="radio" name="era" value="onlyRoman" id="onlyRoman"><label for="onlyRoman"> '+l.roman_only+'</label><br/><div style="margin-top:8px"><strong>'+l.visibility_of_sites+':</strong></div><input type="radio" name="visibility" value="onlyVisible" id="onlyVisible"><label for="onlyVisible"> '+l.visible_sites+'</label><br/><input type="radio" name="visibility" value="anyVisibility" id="anyVisibility"><label for="anyVisibility"> '+l.visible_and_invisible+'</label><br/><div style="margin-top:8px"><strong>'+l.Map_background+':</strong></div><input type="radio" name="map" value="SATELLITE" id="SATELLITE"><label for="SATELLITE"> '+l.satellite+'</label><br/><input type="radio" name="map" value="HYBRID" id="HYBRID"><label for="HYBRID"> '+l.satellite_labels+'</label><br/><input type="radio" name="map" value="IMPERIUM" id="IMPERIUM"><label for="IMPERIUM"> '+l.pelagios+"</label><br/></div></div>",$(a).append(v),$("#vicihandle").click(function(){$("#viciform").toggle(100)}),$("input[name=visibility]").change(function(){r.visibility=$("input[name='visibility']:checked").val();for(var a in A)A[a].selectImage();g("visibility",r.visibility,30)}),$("input[name=era]").change(function(){r.era=$("input[name='era']:checked").val();for(var a in A)A[a].selectImage();g("era",r.era,30)}),$("input[name=map]").change(function(){switch("IMPERIUM"==r.map&&$("#imperiumBox").hide(),r.map=$("input[name='map']:checked").val(),r.map){case"HYBRID":s.setMapTypeId(google.maps.MapTypeId.HYBRID);break;case"SATELLITE":s.setMapTypeId(google.maps.MapTypeId.SATELLITE);break;case"IMPERIUM":s.setMapTypeId("IMPERIUM"),$("#imperiumBox").show()}g("map",r.map,30)}),$("#"+r.visibility).prop("checked",!0),$("#"+r.era).prop("checked",!0),$("#"+r.map).prop("checked",!0)}var w=document.createElement("div");w.style.position="absolute",w.style.top="6px",w.style.right="6px",w.style.width="270px",w.style.color="#fff",w.style.fontFamily="Helvetica",w.style.fontSize="12px",w.style.lineHeight="120%",w.style.backgroundImage="url("+c+"/images/black_50.png)",w.style.zIndex="2",$(a).append(w);var z=new Array,A=new Array,B={markerId:null,marker:new google.maps.Marker({position:new google.maps.LatLng(52,5.2),map:s,visible:!1,icon:new google.maps.MarkerImage(c+"/images/glow.png",new google.maps.Size(32,37),null,new google.maps.Point(16,37),null),zIndex:15})};highlightsArr=new Array;var C=function(){A[B.markerId].restoreState(s.getZoom()),B.marker.setVisible(!1),B.markerId=null,y(null),i("focus"),i("minzoom")},D=function(){highlightsArr.length=0,y(B.markerId)};$.ajaxPrefilter("json",function(a,b,c){return a.crossDomain&&!$.support.cors?"jsonp":void 0}),google.maps.event.addListener(s,"bounds_changed",function(){b.showPrefbox&&$("#viciform").hide(100);var a=new google.maps.LatLngBounds;a=this.getBounds(),B.markerId&&(a.contains(B.marker.position)||C()),o(s),r.highlights>0&&p(a.toUrlValue(),s.getZoom());var c=new google.maps.LatLng;c=this.getCenter(),g("center",c.toUrlValue(),30)}.debounce(300)),google.maps.event.addListener(s,"zoom_changed",function(){var a=s.getZoom();b.showPrefbox&&$("#viciform").hide(100),g("zoom",a,30);for(var c in A)A[c].selectImage();for(var c in z)z[c].strokeWeight=z[c].calcWeight(a),z[c].setOptions(z[c])}.debounce(300))}Function.prototype.debounce=function(a,b){var d,c=this;return function(){function g(){b||c.apply(e,f),d=null}var e=this,f=arguments;d?clearTimeout(d):b&&c.apply(e,f),d=setTimeout(g,a||100)}};